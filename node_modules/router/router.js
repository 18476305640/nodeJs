
const url = require('url');
const fs = require('fs');
const mime = require('mime');
const urlencode = require('urlencode');
const ejs = require('ejs');
exports.static = function(request,response,staticPath) {
    
    let path = url.parse(request.url).pathname=="/"?"/index.html": urlencode.decode(url.parse(request.url).pathname, 'utf-8'); //w3cnote/es6-promise.html
    let path_arr = path.split('.'); //后缀名：path_arr[path_arr.length-1]
    try {
        let data = fs.readFileSync('./'+staticPath+'/'+path);
        if(data) {
            let xm = mime.mime('.'+path_arr[path_arr.length-1]);
            response.writeHead(200,{"Content-type": xm+";charset='utf-8'"});
            response.end(data);
            return true;
        }else {
            return false;
        }
    }catch(error) {
    }
    
}
//路由
exports.mapper = {
    login(request,response){
        ejs.renderFile('./views/login.ejs', {}, (err, data) => {
            response.writeHead(200, { "Content-type": "text/html;charset='utf-8'" });
            response.end(data);
        });
    },
    dologin(request,response){
        response.writeHead(200, { "Content-type": "text/html;charset='utf-8'" });
        response.end("dologin~");
    },
    error(request,response) {
        response.writeHead(404, { "Content-type": "text/html;charset='utf-8'" });
        response.end('404页面不存在')
    }

}


